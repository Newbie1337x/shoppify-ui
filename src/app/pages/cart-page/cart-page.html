<div class="cart-container">
  <h2>ğŸ›’ Tu carrito</h2>

  @if (cartItems().length > 0) {
  <div class="cart-main-content">

    <div class="cart-list">
      @for (item of cartItems(); track item.id) {
      <div class="cart-item">
        <label class="select-label">
          <input type="checkbox" [checked]="selectedItems().has(item.id)"
            (change)="toggleSelection(item.id, $any($event.target).checked)" />
          Seleccionar
        </label>

        <app-product-card class="product-card" [product]="item"></app-product-card>

        <div class="cart-controls">
          <div class="quantity-control">
            <label>Cantidad:</label>
            <div class="quantity-buttons">
              <button type="button" (click)="changeQuantity(item, -1)">-</button>
              <input type="number" [value]="item.stock" readonly />
              <button type="button" (click)="changeQuantity(item, 1)">+</button>
            </div>
          </div>

          <p class="item-subtotal">
            Subtotal:
            <strong>${{ item.price * item.stock }}</strong>
          </p>
          
          <button class="remove-btn" (click)="removeFromCart(item.id)">Eliminar del carrito âŒ</button>
        </div>
      </div>
      }

      @if (selectedItems().size > 0) {
      <div class="remove-selected-container">
        <button class="remove-selected-btn" (click)="removeSelected()">
          ğŸ—‘ï¸ Eliminar seleccionados
        </button>
      </div>
      }
    </div>
    <div class="cart-right-column">

      <form [formGroup]="checkoutForm" class="checkout-form">
        <div class="form-grid">
          <label>
            MÃ©todo de pago:
            <select formControlName="paymentMethod" required>
              <option value="CASH">Efectivo</option>
              <option value="CREDIT">Tarjeta</option>
              <option value="DEBIT">Debito</option>
              <option value="DIGITAL">Pago digital</option>
            </select>
          </label>

          @if (permits.includes("ADMIN")) {
          <label>
            Tipo de transacciÃ³n:
            <select formControlName="type" required defaultValue="SALE">
              <option value="SALE">Venta</option>
              <!-- <option value="PURCHASE">Compra</option> -->
            </select>
          </label>

          <!-- <label>
            Tienda:
            <input type="text" formControlName="storeName" placeholder="Nombre de la tienda">
          </label> -->

          <label class="description">
            DescripciÃ³n:
            <textarea formControlName="description" rows="2" placeholder="Notas de la venta..."></textarea>
          </label>
          }
        </div>
      </form>

      <div class="cart-summary">
        @if (selectedTotal() == 0) {
          <p><strong>Total:</strong> ${{ total() }}</p>
        } @else {
          <p><strong>Total:</strong> ${{ selectedTotal() }}</p>
        }
      </div>
    </div>

  </div>

  <button form="checkout-form" (click)="onSubmit()" [disabled]="checkoutForm.invalid || cartItems().length === 0"
    class="checkout-btn">
    Finalizar transacciÃ³n
  </button>

  } @else {
  <div class="empty-cart">
    <h3>Tu carrito estÃ¡ vacÃ­o ğŸ˜•</h3>
    <p>Agrega algunos productos para comenzar ğŸ’ª.</p>
  </div>
  }
</div>